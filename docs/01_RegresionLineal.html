<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aitor Ameztegui (UdL)">
<meta name="dcterms.date" content="2024-08-22">

<title>Apuntes y ejercicios de geoestadística para forestales - 4&nbsp; Regresión lineal en R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02_GLM.html" rel="next">
<link href="./00_RMarkdown_Quarto.html" rel="prev">
<link href="./images/udl.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_RegresionLineal.html">UNIDAD 1: ANÁLISIS DE REGRESIÓN</a></li><li class="breadcrumb-item"><a href="./01_RegresionLineal.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regresión lineal en R</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Apuntes y ejercicios de geoestadística para forestales</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ameztegui/labs_geoestadistica_forestal" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentación</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">UNIDAD 0: INTRODUCCION</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_Familiar_RStudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Familiarizándose con R y RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_Intro_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introducción a R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_RMarkdown_Quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introducción a Quarto y RMarkdown</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">UNIDAD 1: ANÁLISIS DE REGRESIÓN</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_RegresionLineal.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regresión lineal en R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_GLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Regresión lineal generalizada (GLM) en R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">UNIDAD 2: GEOESTADÍSTICA Y ANÁLISIS ESPACIAL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_DatosEspaciales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Trabajando con datos espaciales en R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_AutocorrelacionEspacial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Autocorrelación espacial en ArcGIS y R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_PatronPuntos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Análisis de patrón de puntos en R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_InterpolacionEspacial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Interpolación espacial en R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_RegresionEspacial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Regresión espacial en R</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#antes-de-ajustar-la-regresión" id="toc-antes-de-ajustar-la-regresión" class="nav-link active" data-scroll-target="#antes-de-ajustar-la-regresión"><span class="header-section-number">4.1</span> Antes de ajustar la regresión…</a></li>
  <li><a href="#nuestros-datos" id="toc-nuestros-datos" class="nav-link" data-scroll-target="#nuestros-datos"><span class="header-section-number">4.2</span> Nuestros datos</a></li>
  <li><a href="#la-regresión-lineal-en-r" id="toc-la-regresión-lineal-en-r" class="nav-link" data-scroll-target="#la-regresión-lineal-en-r"><span class="header-section-number">4.3</span> La regresión lineal en R</a></li>
  <li><a href="#regresión-lineal-simple" id="toc-regresión-lineal-simple" class="nav-link" data-scroll-target="#regresión-lineal-simple"><span class="header-section-number">4.4</span> Regresión lineal simple</a>
  <ul class="collapse">
  <li><a href="#visualizando-la-regresión" id="toc-visualizando-la-regresión" class="nav-link" data-scroll-target="#visualizando-la-regresión"><span class="header-section-number">4.4.1</span> Visualizando la regresión</a></li>
  <li><a href="#haciendo-predicciones-a-partir-de-nuestro-modelo" id="toc-haciendo-predicciones-a-partir-de-nuestro-modelo" class="nav-link" data-scroll-target="#haciendo-predicciones-a-partir-de-nuestro-modelo"><span class="header-section-number">4.4.2</span> Haciendo predicciones a partir de nuestro modelo</a></li>
  </ul></li>
  <li><a href="#regresión-lineal-múltiple" id="toc-regresión-lineal-múltiple" class="nav-link" data-scroll-target="#regresión-lineal-múltiple"><span class="header-section-number">4.5</span> Regresión lineal múltiple</a></li>
  <li><a href="#testando-las-asunciones-del-modelo" id="toc-testando-las-asunciones-del-modelo" class="nav-link" data-scroll-target="#testando-las-asunciones-del-modelo"><span class="header-section-number">4.6</span> Testando las asunciones del modelo</a>
  <ul class="collapse">
  <li><a href="#linealidad" id="toc-linealidad" class="nav-link" data-scroll-target="#linealidad"><span class="header-section-number">4.6.1</span> Linealidad</a></li>
  <li><a href="#independencia" id="toc-independencia" class="nav-link" data-scroll-target="#independencia"><span class="header-section-number">4.6.2</span> Independencia</a></li>
  <li><a href="#homocedasticidad" id="toc-homocedasticidad" class="nav-link" data-scroll-target="#homocedasticidad"><span class="header-section-number">4.6.3</span> Homocedasticidad</a></li>
  <li><a href="#normalidad" id="toc-normalidad" class="nav-link" data-scroll-target="#normalidad"><span class="header-section-number">4.6.4</span> Normalidad</a></li>
  </ul></li>
  <li><a href="#regresión-usando-variables-espacialmente-continuas" id="toc-regresión-usando-variables-espacialmente-continuas" class="nav-link" data-scroll-target="#regresión-usando-variables-espacialmente-continuas"><span class="header-section-number">4.7</span> Regresión usando variables espacialmente continuas</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/ameztegui/labs_geoestadistica_forestal/edit/main/01_RegresionLineal.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/ameztegui/labs_geoestadistica_forestal/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regresión lineal en R</span></h1>
<p class="subtitle lead">Geoestadística i Tècniques d’Observació Global (24/25)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aitor Ameztegui (UdL) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 22, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="antes-de-ajustar-la-regresión" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="antes-de-ajustar-la-regresión"><span class="header-section-number">4.1</span> Antes de ajustar la regresión…</h2>
<p>Como hemos visto en teoría, la regresión lineal es el proceso de obtención de una ecuación o fórmula matemática que capture la relación entre una variable respuesta o dependiente y una o varias variables explicativas o independientes. En realidad, esta definición encaja en cualquier tipo de regresión, no sólo la lineal, y la particularidad de la regresión lineal es que asumimos que la relación entre la variable dependiente (que llamaremos <code>y</code>) y la variable explicativa (<code>x</code>) es lineal, es decir, que la ecuación es una recta.</p>
</section>
<section id="nuestros-datos" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="nuestros-datos"><span class="header-section-number">4.2</span> Nuestros datos</h2>
<p>Para esta actividad vamos a trabajar con la tabla (o <code>data frame</code>) llamado <code>meteo</code>, que podemos encontrar en el campus virtual, dentro de la carpeta “Recursos/Datos/meteo”, en un fichero llamado “meteo.txt”. Dicha tabla contiene las siguientes variables climáticas del mes de junio, extraídas de una serie de estaciones meteorológicas en el valle del Ebro:</p>
<ul>
<li><p><strong>TavgMAX</strong>: temperatura media de las máximas de junio, en ºC</p></li>
<li><p><strong>Tavg</strong>: temperatura media diaria de junio, en ºC</p></li>
<li><p><strong>d_atl</strong>: distancia al océano Atlántico (en m)</p></li>
<li><p><strong>d_medit</strong>: distancia al mar Mediterráneo en m</p></li>
<li><p><strong>elevation</strong>: altitud sobre el nivel del mar (m)</p></li>
<li><p><strong>long</strong>: longitud en UTM, sistema de referencia EPSG:23030</p></li>
<li><p><strong>lat</strong>: latitud en UTM, sistema de referencia EPSG:23030</p></li>
</ul>
<p>Para cargar la tabla a nuestra sesión de R debemos guardarla en el ordenador, y después podemos usar el menú “Import Dataset” o copiar y ejecutar el siguiente código:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>meteo <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"./data/meteo/meteo.txt"</span>,  <span class="co"># cambia la ruta según el caso!!!!</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">date_names =</span> <span class="st">"es"</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">decimal_mark =</span> <span class="st">","</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">grouping_mark =</span> <span class="st">"."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez el data frame está cargado, podemos echar un vistazo a las variables (y su tipo) tecleando <code>head()</code> o <code>summary()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(meteo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  TavgMAX  Tavg   long  d_atl d_medit     lat elevation
    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1    20.3  14.6 614350 305753  152147 4489750      1423
2    23.8  16.1 593950 271251  183121 4522150      1100
3    24.4  18.2 567250 279823  204123 4512650      1229
4    20.1  14.0 609150 319257  150357 4475450      1610
5    20.3  13.8 629450 306673  138390 4491350      1402
6    21.9  16.2 666750 317312  103530 4489850      1022</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(meteo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    TavgMAX           Tavg            long            d_atl       
 Min.   :18.20   Min.   :13.85   Min.   :566050   Min.   : 43783  
 1st Qu.:23.00   1st Qu.:16.80   1st Qu.:628925   1st Qu.:132564  
 Median :25.05   Median :18.80   Median :690750   Median :211925  
 Mean   :24.79   Mean   :18.64   Mean   :687373   Mean   :216455  
 3rd Qu.:26.90   3rd Qu.:20.55   3rd Qu.:738600   3rd Qu.:293938  
 Max.   :30.50   Max.   :23.50   Max.   :817550   Max.   :425054  
    d_medit            lat            elevation     
 Min.   :   670   Min.   :4399050   Min.   :   2.0  
 1st Qu.: 92912   1st Qu.:4539325   1st Qu.: 302.0  
 Median :159376   Median :4638550   Median : 505.5  
 Mean   :159368   Mean   :4615250   Mean   : 575.7  
 3rd Qu.:227630   3rd Qu.:4700250   3rd Qu.: 813.8  
 Max.   :325945   Max.   :4757850   Max.   :1610.0  </code></pre>
</div>
</div>
<p>El primer paso antes de realizar un análisis de regresión - o de ajustar cualquier modelo - entre dos o más variables es realizar un análisis exploratorio de los datos: podemos, por ejemplo, representar un histograma o boxplot de las variables, para comprobar que no hay valores aberrantes, y es muy recomendable también realizar un gráfico de dispersión (o scatterplot, en inglés) para ver <em>la pinta</em> que tiene la relación entre ellas.</p>
<p>En este caso, nos interesa saber la relación que hay entre la elevación (<code>elevation</code>) y la temperatura media del mes de junio (<code>Tavg</code>), veamos la distribución que siguen ambas variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meteo<span class="sc">$</span>Tavg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(meteo<span class="sc">$</span>elevation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Aparentemente, no presentan problemas. Ambas siguen distribuciones bastante normales, sin presencia de valores anómalos, o distribuciones sesgadas. También podemos analizar su distribución mediante boxplots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(meteo<span class="sc">$</span>Tavg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(meteo<span class="sc">$</span>elevation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Y finalmente, veamos la magnitud de la relación entre ambas a través de su coeficiente de correlación. Para calcularlo usaremos la función <code>cor()</code> de R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(meteo<span class="sc">$</span>elevation, meteo<span class="sc">$</span>Tavg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.8629255</code></pre>
</div>
</div>
<p>También es siempre recomendable evaluar la forma de la relación entre ambas a través de un gráfico de dispersión o scatterplot, para detectar posibles tendencias no lineales:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> meteo<span class="sc">$</span>elevation, <span class="at">y =</span> meteo<span class="sc">$</span>Tavg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Parece que sí puede haber una relación, y que efectivamente tiene aspecto de ser lineal. Vamos a ajustar la regresión para comprobarlo:</p>
</section>
<section id="la-regresión-lineal-en-r" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="la-regresión-lineal-en-r"><span class="header-section-number">4.3</span> La regresión lineal en R</h2>
<p>R tiene incluidas una serie de funciones estadísticas, las principales, que se incluyen en el paquete <code>stats</code>, que viene por defecto instalado en R (no hace falta instalarlo). Para ajustar, o calibrar, regresiones lineales, utilizaremos la función <code>lm</code>. Podemos teclear <code>help("lm")</code> para ver cómo funciona y qué argumentos requiere esta función:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(<span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(formula, data, subset, weights, na.action, <span class="at">method =</span> <span class="st">"qr"</span>, <span class="at">model =</span> <span class="cn">TRUE</span>, <span class="at">x =</span> <span class="cn">FALSE</span>, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> <span class="cn">FALSE</span>, <span class="at">qr =</span> <span class="cn">TRUE</span>, <span class="at">singular.ok =</span> <span class="cn">TRUE</span>, <span class="at">contrasts =</span> <span class="cn">NULL</span>, offset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vemos que hay numerosos argumentos, pero la mayoría no son necesarios a no ser que queramos una configuración particular. En realidad sólo necesitamos dos:</p>
<ul>
<li><p><code>formula</code>: aquí especificamos qué variables, de las incluidas en nuestra tabla, usaremos para ajustar la regresión. Además, al contrario que en la correlación, debemos definir cuál es la variable dependiente, y cuál o cuales son las variables independientes. Una fórmula tiene este aspecto:</p>
<p><code>var_dep ~ v_indep_1 + v_indep_2 + v_indep_3 +</code></p></li>
</ul>
<p>Como vemos, la var. dependiente y la/s independiente/s se separan por el operador <code>~</code></p>
<ul>
<li><code>data</code>: especifica el objeto que contiene las variables. Todas las variables definidas en la fórmula deben estar incluidas en <code>data</code></li>
</ul>
</section>
<section id="regresión-lineal-simple" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="regresión-lineal-simple"><span class="header-section-number">4.4</span> Regresión lineal simple</h2>
<p>Vamos a ajustar una regresión simple (llamada así porque sólo contiene una variable independiente), en la que evaluaremos el papel de la altitud (<code>elevation</code>) en la temperatura media (<code>Tavg</code>), usando el data frame <code>meteo</code> que hemos cargado antes. Para ello especificamos la fórmula:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Tavg <span class="sc">~</span> elevation, <span class="at">data =</span> meteo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Tavg ~ elevation, data = meteo)

Coefficients:
(Intercept)    elevation  
  21.923433    -0.005711  </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Es importante tener claro que en el caso de una regresión lineal, tendremos una variable que queremos predecir (variable dependiente, <code>Tavg</code>) y otra a partir de la que obtendremos las predicciones (var. independiente, <code>elevation</code>). Es decir, queremos predecir la temperatura a partir de la elevación. Debemos tener eso en cuenta a la hora de definir la fórmula.</p>
</blockquote>
<p>Ejecutando el código de arriba obtenemos la lista de los coeficientes de regresión (<span class="math inline">\(\beta_0\)</span> y <span class="math inline">\(\beta_1\)</span>), que son útiles para construir la ecuación de la recta de regresión. Un coeficiente positivo indica que la relación entre la variable dependiente y la variable independiente es positiva, y al contrario. En este caso, el resultado nos dice que, cada metro que subimos en altitud, la temperatura baja de media 0.0057 grados. O lo que es lo mismo, cada 100 m que subimos, baja 0.57 grados la temperatura Por otro lado, el coeficiente del <code>intercepto</code> puede interpretarse como <span class="math inline">\(\beta_0\)</span>, el valor de temperatura cuando la altitud es igual a 0.</p>
<p>Sin embargo, si ejecutamos <code>lm</code> (o cualquier otra función) sin guardar el resultado, se imprime en la consola pero no se guarda. Para guardarlo, le asignaremos un nombre, el que queramos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mod_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Tavg <span class="sc">~</span> elevation, <span class="at">data =</span> meteo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora lo guarda, pero no imprime nada. Si tecleamos el nombre del objeto, lo imprime, y obtenemos lo mismo que antes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mod_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Tavg ~ elevation, data = meteo)

Coefficients:
(Intercept)    elevation  
  21.923433    -0.005711  </code></pre>
</div>
</div>
<p>O aún mejor, podemos usar la función <code>summary()</code>, que proporciona mucha más información:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Tavg ~ elevation, data = meteo)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.7830 -0.7583 -0.0210  0.8804  3.4625 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 21.9234334  0.1481962  147.94   &lt;2e-16 ***
elevation   -0.0057107  0.0002196  -26.01   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.184 on 232 degrees of freedom
Multiple R-squared:  0.7446,    Adjusted R-squared:  0.7435 
F-statistic: 676.5 on 1 and 232 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Veamos que podemos obtener de <code>summary()</code>:</p>
<ul>
<li><p>El <strong>grado de ajuste</strong> (o bondad de ajuste) del modelo (<code>R-squared</code>), calculada a través del estadístico <span class="math inline">\(F\)</span>, y su significación</p></li>
<li><p>Los <strong>cuartiles de los residuos</strong>, que nos dan una idea de si los residuos se encuentran simétricamente distribuidos a ambos lados del 0 - lo que sería deseable - o no.</p></li>
<li><p>La estimación de los <strong>coeficientes</strong> del modelo, tanto el intercepto como cada una de las variables explicativas. Estos números son los que forman parte de la fórmula de regresión.</p></li>
<li><p>La <strong>significación de los coeficientes</strong>: junto con la estmación del coeficiente, se nos da el cálculo del error estándar y del estadístico <span class="math inline">\(t\)</span>, que se usa para evaluar el p-valor, representado aquí por la columna <code>Pr(&gt;|t|</code>)</p></li>
</ul>
<section id="visualizando-la-regresión" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="visualizando-la-regresión"><span class="header-section-number">4.4.1</span> Visualizando la regresión</h3>
<p>Como hemos guardado el resultado de la regresión en un objeto (que hemos llamado <code>mod_lm</code>), podemos usarlo, por ejemplo, para hacer gráficas.</p>
<p>Empecemos por plotear como antes la elevación y la temperatura:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(meteo<span class="sc">$</span>elevation, meteo<span class="sc">$</span>Tavg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ahora podemos añadir la ecuación de regresión usando la función <code>abline()</code>. Esta función tiene como argumento un objeto de regresión, y nos devuelve la linea recta calculada mediante la regresión:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(meteo<span class="sc">$</span>elevation, meteo<span class="sc">$</span>Tavg) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(mod_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>integer(0)</code></pre>
</div>
</div>
<p>En contra de lo que cabría esperar, si ploteamos directamente el objeto de la regresión no nos dará la gráfica de arriba, sino que nos da una serie de gráficos sobre los residuos, que veremos más adelante.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Sobre la visualización de los datos</strong> <br> <br> Ya hemos comentado varias veces la importancia de visualizar nuestros datos antes de extraer ninguna conclusión de ellos. Hay una cierta tendencia a considerar que una simple visualización no aporta demasiado, ya que sólo podemos llegar a conclusiones cualitativas, mientras que un análisis de correlación o regresión es <em>estadística</em> y por tanto nos proporcionan información numérica que podemos cuantificar (¿es la variable significativa?). Sin embargo, no debemos NUNCA interpretar los resultados de un análisis sin visualizar los datos. <br><br> Un ejemplo de esto es el cuarteto de Anscombe, creado en 1973 por el estadístico británico Francis Anscombe. Se trata de cuatro datasets que contienen cada uno una variable <code>x</code> y una <code>y</code>. Podemos acceder a ellos mediante el paquete <code>datasets</code>, con la instrucción <code>library(datasets)</code> y tecleando a continuación <code>anscombe</code><br><br> Para comprobar qué tiene de particular este dataset, realizad lo siguiente: <br><br> 1. Calculad la media y desviación típica de todas las <code>x</code>, y de todas las <code>y</code> <br> 2. Calculad la correlación entre <code>x</code> e <code>y</code> para los cuatro datasets <br> 3. Ajustad un modelo lineal para cada par de <code>x</code> e <code>y</code> <br> 4. Representad visualmente cada pareja de <code>x</code> e <code>y</code> <br><br> ¿Qué observamos? <br> <br> </p>
</blockquote>
</section>
<section id="haciendo-predicciones-a-partir-de-nuestro-modelo" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="haciendo-predicciones-a-partir-de-nuestro-modelo"><span class="header-section-number">4.4.2</span> Haciendo predicciones a partir de nuestro modelo</h3>
<p>Uno de los objetivos principales de la regresión es conocer la ecuación que relaciona la variable dependiente con la independiente, de manera que podamos predecir, para cualquier valor de <span class="math inline">\(x\)</span>, cual sería el valor de <span class="math inline">\(y\)</span> esperado.</p>
<p>Para hacer predicciones, podríamos simplemente construir una nueva variable usando los coeficientes obtenidos de la regresión:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)    elevation 
21.923433399 -0.005710663 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>predicciones <span class="ot">&lt;-</span> <span class="fl">21.923433</span> <span class="sc">-</span> <span class="fl">0.005711</span><span class="sc">*</span>meteo<span class="sc">$</span>elevation</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>predicciones</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 13.79668 15.64133 14.90461 12.72872 13.91661 16.08679 16.88633 17.19472
  [9] 14.45344 15.15019 18.55965 18.94229 21.24382 21.79779 21.79779 21.46655
 [17] 21.80350 17.26326 21.78637 14.19645 15.37863 16.06395 16.25241 16.44658
 [25] 14.29925 14.53340 19.54195 20.82121 15.44716 20.51282 20.43286 21.91201
 [33] 21.72355 21.84919 21.02109 21.80921 21.42658 15.36149 21.28951 19.43344
 [41] 20.31293 18.97085 16.97771 17.33179 18.63961 19.58192 19.48484 20.30151
 [49] 14.99028 15.16732 16.52083 16.84635 16.82351 16.93202 17.31466 17.34321
 [57] 16.11535 16.27525 17.50312 17.92573 17.82294 19.15360 19.42773 17.78867
 [65] 19.02796 18.31979 19.31922 18.59392 16.05824 17.88004 18.26268 18.91374
 [73] 19.19357 19.47341 18.45115 18.95942 19.80465 20.25582 18.37690 18.37690
 [81] 18.77096 19.02224 18.78809 19.38775 18.61105 18.91945 18.94229 19.06793
 [89] 19.15360 16.85206 16.92060 20.05594 20.20442 20.33006 20.43286 20.31864
 [97] 20.43286 20.31864 17.86291 19.57050 19.94743 20.30722 19.30208 19.69043
[105] 19.69043 20.62704 17.38890 19.45628 20.35291 17.61734 19.48484 20.31864
[113] 19.44486 20.71841 17.67445 15.60136 17.75440 18.43972 16.13819 14.49913
[121] 15.13876 14.82466 17.60021 19.47912 16.99484 18.52539 19.73041 19.95314
[129] 18.51397 20.60419 18.39403 20.74126 20.73554 14.29925 15.90975 17.09193
[137] 16.99484 17.53167 16.82922 18.03424 18.99369 19.17073 18.78238 18.73669
[145] 19.73041 17.49741 19.75896 19.86747 19.71328 20.41573 20.53566 20.68415
[153] 19.75896 19.74183 21.05536 17.12619 17.02911 18.77667 16.50369 16.51512
[161] 18.62247 20.14731 20.33577 20.70699 18.47970 14.69331 15.68702 16.09250
[169] 14.95601 18.19415 19.31922 20.15873 21.16958 21.09534 20.39860 18.97656
[177] 19.98740 20.79265 20.86119 20.31864 15.74413 18.97656 18.89660 19.05651
[185] 18.69101 12.87150 19.12504 18.26839 18.50825 19.45628 20.05022 20.00454
[193] 20.07307 17.66874 20.51282 20.56993 19.26782 19.74754 18.83378 20.52995
[201] 20.52995 18.88518 16.08679 19.42773 19.86747 19.85034 20.18158 19.75896
[209] 19.81036 19.81036 20.09591 20.55850 20.15873 20.34720 21.15816 19.23355
[217] 17.84578 18.93087 20.23298 19.04509 20.87261 19.39346 21.75210 19.10220
[225] 21.73497 19.86176 20.64417 20.23298 21.60933 15.29296 16.12106 16.07537
[233] 16.19530 15.47571</code></pre>
</div>
</div>
<p>Sin embargo, <code>R</code> incluye la función <code>predict()</code> que hace esto por nosotros automáticamente, lo cual es muy útil sobre todo en el caso de regresiones múltiples. <code>predict()</code> necesita que le demos dos inputs:</p>
<ul>
<li>un objeto de regresión (en este caso <code>mod_lm</code>)</li>
<li>una tabla o data frame que contenga todas y cada una de las variables explicativas usadas para ajustar el modelo</li>
</ul>
<p>Lo que hace <code>predict()</code> es, para cada fila de la tabla que le indiquemos, calcular el valor de <span class="math inline">\(y\)</span> usando los valores de las diferentes <span class="math inline">\(x\)</span> para esa fila y los coeficientes estimados por el modelo. En el caso de la regresión simple, <code>mod_lm</code> calculará el valor de temperatura media para cada valor de altitud que contenga la tabla:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod_lm, meteo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6        7        8 
13.79716 15.64170 14.90503 12.72927 13.91708 16.08714 16.88663 17.19500 
       9       10       11       12       13       14       15       16 
14.45389 15.15059 18.55985 18.94247 21.24386 21.79780 21.79780 21.46658 
      17       18       19       20       21       22       23       24 
21.80351 17.26353 21.78638 14.19691 15.37901 16.06429 16.25275 16.44691 
      25       26       27       28       29       30       31       32 
14.29970 14.53384 19.54209 20.82128 15.44754 20.51290 20.43295 21.91201 
      33       34       35       36       37       38       39       40 
21.72356 21.84919 21.02115 21.80922 21.42661 15.36188 21.28955 19.43358 
      41       42       43       44       45       46       47       48 
20.31303 18.97102 16.97800 17.33206 18.63980 19.58206 19.48498 20.30161 
      49       50       51       52       53       54       55       56 
14.99069 15.16772 16.52115 16.84665 16.82381 16.93231 17.31493 17.34348 
      57       58       59       60       61       62       63       64 
16.11569 16.27559 17.50338 17.92597 17.82318 19.15376 19.42787 17.78891 
      65       66       67       68       69       70       71       72 
19.02813 18.32001 19.31937 18.59412 16.05858 17.88028 18.26290 18.91391 
      73       74       75       76       77       78       79       80 
19.19374 19.47356 18.45135 18.95960 19.80478 20.25592 18.37711 18.37711 
      81       82       83       84       85       86       87       88 
18.77115 19.02242 18.78828 19.38790 18.61125 18.91962 18.94247 19.06810 
      89       90       91       92       93       94       95       96 
19.15376 16.85236 16.92089 20.05605 20.20452 20.33016 20.43295 20.31874 
      97       98       99      100      101      102      103      104 
20.43295 20.31874 17.86315 19.57064 19.94754 20.30732 19.30224 19.69056 
     105      106      107      108      109      110      111      112 
19.69056 20.62711 17.38917 19.45643 20.35300 17.61759 19.48498 20.31874 
     113      114      115      116      117      118      119      120 
19.44501 20.71848 17.67470 15.60173 17.75465 18.43993 16.13853 14.49957 
     121      122      123      124      125      126      127      128 
15.13917 14.82508 17.60046 19.47927 16.99513 18.52559 19.73054 19.95325 
     129      130      131      132      133      134      135      136 
18.51417 20.60427 18.39424 20.74133 20.73562 14.29970 15.91011 17.09221 
     137      138      139      140      141      142      143      144 
16.99513 17.53193 16.82952 18.03447 18.99386 19.17089 18.78257 18.73688 
     145      146      147      148      149      150      151      152 
19.73054 17.49767 19.75909 19.86759 19.71341 20.41582 20.53574 20.68422 
     153      154      155      156      157      158      159      160 
19.75909 19.74196 21.05541 17.12648 17.02940 18.77686 16.50401 16.51544 
     161      162      163      164      165      166      167      168 
18.62267 20.14742 20.33587 20.70706 18.47990 14.69373 15.68739 16.09285 
     169      170      171      172      173      174      175      176 
14.95642 18.19437 19.31937 20.15884 21.16963 21.09539 20.39869 18.97673 
     177      178      179      180      181      182      183      184 
19.98752 20.79272 20.86125 20.31874 15.74450 18.97673 18.89678 19.05668 
     185      186      187      188      189      190      191      192 
18.69120 12.87203 19.12521 18.26861 18.50846 19.45643 20.05034 20.00465 
     193      194      195      196      197      198      199      200 
20.07318 17.66899 20.51290 20.57001 19.26798 19.74767 18.83396 20.53003 
     201      202      203      204      205      206      207      208 
20.53003 18.88536 16.08714 19.42787 19.86759 19.85046 20.18168 19.75909 
     209      210      211      212      213      214      215      216 
19.81049 19.81049 20.09602 20.55858 20.15884 20.34729 21.15820 19.23371 
     217      218      219      220      221      222      223      224 
17.84602 18.93105 20.23308 19.04526 20.87267 19.39361 21.75211 19.10237 
     225      226      227      228      229      230      231      232 
21.73498 19.86188 20.64424 20.23308 21.60935 15.29335 16.12140 16.07571 
     233      234 
16.19564 15.47609 </code></pre>
</div>
</div>
<p>Incluso podemos guardar estas predicciones como una columna más de <code>meteo</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>meteo<span class="sc">$</span>pred <span class="ot">&lt;-</span>  <span class="fu">predict</span>(mod_lm, meteo)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(meteo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  TavgMAX  Tavg   long  d_atl d_medit     lat elevation  pred
    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
1    20.3  14.6 614350 305753  152147 4489750      1423  13.8
2    23.8  16.1 593950 271251  183121 4522150      1100  15.6
3    24.4  18.2 567250 279823  204123 4512650      1229  14.9
4    20.1  14.0 609150 319257  150357 4475450      1610  12.7
5    20.3  13.8 629450 306673  138390 4491350      1402  13.9
6    21.9  16.2 666750 317312  103530 4489850      1022  16.1</code></pre>
</div>
</div>
<p>Ahora podríamos hacer un gráfico que compare los valores predichos y los observados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(meteo<span class="sc">$</span>Tavg, meteo<span class="sc">$</span>pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Lo interesante de la función <code>predict()</code> es que no hace falta aplicarla a la misma tabla de datos que hemos usado para ajustar el modelo, sino que si tenemos una serie de datos nueva (de otras estaciones, u otras fechas) también podemos calcular el valor predicho por el modelo. En este caso, para cualquier punto del que tengamos la altitud, podemos determinar la temperatura media. Abramos el otro fichero que teníamos disponible en el campus virtual, llamado <code>meteo_nuevo.txt</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>meteo2 <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"./data/meteo/meteo_nuevo.txt"</span>, <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 100 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
dbl (2): elevation, d_medit

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>meteo2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 2
   elevation d_medit
       &lt;dbl&gt;   &lt;dbl&gt;
 1      793.  204153
 2      864.  193620
 3      939.  209678
 4      706.  221949
 5      787.  210552
 6      934.  188943
 7      802.  222480
 8     1061.  203576
 9      836.  219916
10      735.  202829
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Vemos que es una tabla que contiene valores de altitud y distancia al mediterráneo, pero no contiene de hecho valores de temperatura. En base al modelo que ajustamos antes, podemos generarlos con <code>predict()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>meteo2<span class="sc">$</span>temp <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_lm, meteo2)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>meteo2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 3
   elevation d_medit  temp
       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1      793.  204153  17.4
 2      864.  193620  17.0
 3      939.  209678  16.6
 4      706.  221949  17.9
 5      787.  210552  17.4
 6      934.  188943  16.6
 7      802.  222480  17.3
 8     1061.  203576  15.9
 9      836.  219916  17.1
10      735.  202829  17.7
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Esta opción es muy interesante, ya que cuando generamos una ecuación de regresión, raramente queremos aplicarla sobre los datos ya observados, sino que querremos usarla para predecir valores en aquellos lugares donde no tengamos medidas.</p>
<blockquote class="blockquote">
<p><strong>Consejo:</strong><br><br>Debemos ser responsables, sin embargo, de no extrapolar más allá de lo lógico: si el modelo de regresión se ha ajustado con datos del valle del Ebro, ¿tiene sentido aplicarlos en Galicia?</p>
</blockquote>
</section>
</section>
<section id="regresión-lineal-múltiple" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="regresión-lineal-múltiple"><span class="header-section-number">4.5</span> Regresión lineal múltiple</h2>
<p>De la misma manera que ajustamos una regresión lineal simple, podemos ajustar una múltiple, simplemente añadiendo más variables independientes a la derecha de la fórmula, después del <code>~</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>mod_mult <span class="ot">&lt;-</span> <span class="fu">lm</span>(Tavg <span class="sc">~</span> d_atl <span class="sc">+</span> d_medit <span class="sc">+</span> elevation, <span class="at">data =</span> meteo)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>mod_mult</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Tavg ~ d_atl + d_medit + elevation, data = meteo)

Coefficients:
(Intercept)        d_atl      d_medit    elevation  
  2.156e+01    3.749e-06   -3.393e-06   -5.545e-03  </code></pre>
</div>
</div>
<p>A efectos prácticos, el modelo múltiple y el simple son prácticamente iguales, aunque en este caso la función <code>summary</code> nos da la significación de cada una de las variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Tavg ~ d_atl + d_medit + elevation, data = meteo)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.8514 -0.5623  0.0526  0.6173  3.1647 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.156e+01  9.105e-01  23.676   &lt;2e-16 ***
d_atl        3.749e-06  2.404e-06   1.560    0.120    
d_medit     -3.393e-06  2.846e-06  -1.192    0.235    
elevation   -5.545e-03  2.136e-04 -25.959   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.982 on 230 degrees of freedom
Multiple R-squared:  0.8257,    Adjusted R-squared:  0.8235 
F-statistic: 363.3 on 3 and 230 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Vemos que la R2 del modelo ha mejorado de forma sustancial. Pero recordemos que se considera el efecto de una variable como no significativo si el p-valor asociado a ella es mayor de 0.05. Eso quiere decir que el riesgo de rechazar la hipótesis nula (el riesgo de asumir una relación cuando no la hay) es demasiado alto, y por tanto no la rechazamos. En este caso, vemos que ni la distancia al Mediterráneo ni la distancia al Atlántico resultan significativas. Según lo visto en clase, sería mejor eliminarlas, pero por otro lado nos hacen subir el R2 de manera muy clara. Probemos a quitar sólo una de ellas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mod_mult2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Tavg <span class="sc">~</span> d_medit <span class="sc">+</span> elevation, <span class="at">data =</span> meteo)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_mult2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Tavg ~ d_medit + elevation, data = meteo)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.7490 -0.5785  0.0227  0.5727  3.3712 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.296e+01  1.595e-01  143.88   &lt;2e-16 ***
d_medit     -7.675e-06  7.528e-07  -10.20   &lt;2e-16 ***
elevation   -5.378e-03  1.856e-04  -28.98   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.985 on 231 degrees of freedom
Multiple R-squared:  0.8239,    Adjusted R-squared:  0.8224 
F-statistic: 540.3 on 2 and 231 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>¡Ahora sí que la distancia al Mediterráneo resulta significativa, y la R2 del modelo (0.82) sigue siendo muy superior a la del modelo simple (0.74). Lo curioso es que si hubiéramos eliminado <code>d_medit</code>, también sería significativa <code>d_atl</code> (podéis hacer la prueba) ¿Qué puede estar pasando?</p>
<p>Lo que estamos viendo es un ejemplo de multicolinealidad. Como la distancia al Mediterráneo y al Atlántico están muy relacionadas (si aumenta una, disminuye la otra), si introducimos las dos en el modelo este no es capaz de distinguir el efecto de cada una de ellas, y concluye que no tienen efecto. De hecho, veamos como de correlacionadas están estas dos variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(meteo<span class="sc">$</span>d_atl, meteo<span class="sc">$</span>d_medit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9525821</code></pre>
</div>
</div>
<p>Por tanto, dejaremos sólo una de ellas en el modelo, en este caso la distancia al Mediterráneo. Lo interesante es que podemos predecir temperaturas en nuestra tabla de nuevos valores, usando el modelo de regresión múltiple:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod_mult2, meteo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6        7        8 
17.12514 16.82208 16.29817 17.45700 17.10434 16.48407 16.93618 15.68594 
       9       10       11       12       13       14       15       16 
16.76974 17.44436 18.06764 16.64387 17.27120 16.09408 16.66035 17.05316 
      17       18       19       20       21       22       23       24 
16.14305 14.78709 15.94748 15.39889 20.87385 16.08418 16.61257 17.58826 
      25       26       27       28       29       30       31       32 
16.22689 16.74222 17.28661 14.11201 17.53732 19.11453 14.50081 14.66675 
      33       34       35       36       37       38       39       40 
18.31549 18.71684 13.93286 18.06864 17.19598 19.16897 15.03308 16.40134 
      41       42       43       44       45       46       47       48 
16.58971 16.81448 17.25677 16.16466 16.32135 16.86009 15.64677 17.75046 
      49       50       51       52       53       54       55       56 
14.12446 17.88584 14.74712 16.78598 17.13428 16.43328 18.71701 16.22936 
      57       58       59       60       61       62       63       64 
16.38941 18.04153 17.36000 18.77970 15.24015 17.34046 17.37639 13.99712 
      65       66       67       68       69       70       71       72 
14.95117 18.21192 18.30910 18.33676 16.91608 18.87682 17.01177 15.09166 
      73       74       75       76       77       78       79       80 
18.54233 19.18103 13.98042 17.05097 15.85675 18.48408 17.58232 16.75660 
      81       82       83       84       85       86       87       88 
16.20362 12.84291 16.13229 19.39104 18.98500 17.45716 15.43576 18.05760 
      89       90       91       92       93       94       95       96 
15.81553 17.08892 17.60376 18.81896 15.97251 16.41554 16.04488 17.89542 
      97       98       99      100 
15.21175 17.32653 18.20423 16.26098 </code></pre>
</div>
</div>
<p>Esto funcionará siempre que la tabla que proporcionemos contenga todas y cada una de las variables explicativas del modelo. Si intentamos predecir con el modelo que contiene <code>d_atl</code>, recibiremos este mensaje de error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod_mult, meteo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(predvars, data, env): objeto 'd_atl' no encontrado</code></pre>
</div>
</div>
</section>
<section id="testando-las-asunciones-del-modelo" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="testando-las-asunciones-del-modelo"><span class="header-section-number">4.6</span> Testando las asunciones del modelo</h2>
<p>Hemos visto que los modelos lineales deben cumplir básicamente cuatro criterios:</p>
<section id="linealidad" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="linealidad"><span class="header-section-number">4.6.1</span> Linealidad</h3>
<p>la linealidad entre predictores y variable dependiente se puede evaluar gráficamente. En este caso, la relación entre la cota y la temperatura parece claramente lineal, como ya habíamos visto antes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(meteo<span class="sc">$</span>elevation, meteo<span class="sc">$</span>Tavg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="independencia" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="independencia"><span class="header-section-number">4.6.2</span> Independencia</h3>
<p>Las observaciones deben ser independientes unas de otras (por eso se llaman variables independientes). Aunque una parte importante de la evaluación de la independencia la podemos inferir si conocemos bien la muestra, la gráfica de predichos y residuos nos puede dar también información importante. Ambos los podemos extraer del objeto <code>lm</code> que hayamos guardado, usando las funciones <code>fitted()</code> y <code>residuals()</code>, respectivamente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>predichos <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod_lm)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>residuos <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod_lm)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(predichos, residuos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>No parece presentar mayores problemas.</p>
</section>
<section id="homocedasticidad" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="homocedasticidad"><span class="header-section-number">4.6.3</span> Homocedasticidad</h3>
<p>Otro importante criterio que debe seguir un modelo lineal es el de ser homocedástico. Esto quiere decir que los residuos son independientes a los valores de la variable explicativa. O dicho de otra manera, que la varianza del error es constante a lo largo de las observaciones. Lo podemos ver con la misma gráfica de antes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(predichos, residuos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="normalidad" class="level3" data-number="4.6.4">
<h3 data-number="4.6.4" class="anchored" data-anchor-id="normalidad"><span class="header-section-number">4.6.4</span> Normalidad</h3>
<p>Para evaluar la normalidad de los residuos podemos usar varias gráficas:</p>
<ul>
<li>Histogramas</li>
</ul>
<p>Usaremos la función <code>hist()</code>, sobre los residuos del modelo (que se obtienen con la función <code>residuals()</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(mod_lm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Boxplot</li>
</ul>
<p>Mediante la función <code>boxplot()</code> podemos construir un diagrama de cajas con cualquier variable (en este caso, recordad que se debe hacer sobre los residuos):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">residuals</span>(mod_lm), <span class="at">col =</span> <span class="st">"steelblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>QQplot</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(mod_lm), <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">frame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(mod_lm), <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Todas estas gráficas parecen estar razonablemente bien. Si queremos una evaluación más cuantitativa, también podemos usar tests para saber si los residuos están normalmente distribuidos o no. Un ejemplo es el test de Shapiro-Wilk:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(mod_lm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  residuals(mod_lm)
W = 0.99415, p-value = 0.4982</code></pre>
</div>
</div>
<p>En este caso, la hipótesis nula del test de Shapiro-Wilk es que la distribución de la variable testada es normal. Por lo tanto, si el resultado del test es no significativo quiere decir que no podemos rechazar la hipótesis nula, es decir, que no podemos rechazar que la distribución sea normal (en definitiva, que sí que es normal).</p>
<p>Por supuesto, esta lógica funciona al contrario: si el resultado del test de Shapiro-Wilk es significativo, quiere decir que la variable que estamos testando (en este caso los residuos), no siguen una distribución normal.</p>
<blockquote class="blockquote">
<p><strong>Sobre los tests de normalidad</strong> <br><br> Además del test de Shapiro-Wilk existen otros tests para evaluar de manera estadística si una variable sigue una distribución normal. Aunque se pueden usar para tomar decisiones respecto a un modelo, hay que hacerlo sabiendo que la mayoría de estos tests son muy estrictos. Es decir, que incluso una ligera desviación respecto de la normalidad resultará en significación del test. Debemos tener sentido común para decidir si esto invalida nuestro modelo o no, como hemos visto durante las clases teóricas:</p>
</blockquote>
<p>Por otro lado, como hemos indicado antes, algunas de las gráficas de evaluación de los supuestos del modelo nos los da directamente R mediante el ploteo del objeto <code>lm</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-36-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-36-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-36-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En concreto nos interesan los dos primeros: un scatterplot de residuos vs.&nbsp;predichos, y un qqplot con los residuos. Con ellos podemos testar al menos 3 de las 4 asunciones.</p>
</section>
</section>
<section id="regresión-usando-variables-espacialmente-continuas" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="regresión-usando-variables-espacialmente-continuas"><span class="header-section-number">4.7</span> Regresión usando variables espacialmente continuas</h2>
<p>Hemos visto que la función <code>predict()</code> permite calcular la variable dependiente en función de las variables explicativas. Pero aún más, si tenemos un mapa continuo con los valores de las variables explicativas, <code>predict()</code> nos permitirá generar un raster continuo de predicciones espacializadas. Veamos un ejemplo.</p>
<p>En este caso, tenemos una serie de rasters de una zona de estudio, y que corresponden con las variables que hemos usado antes para ajustar el modelo: altitud, distancia al Atlántico y distancia al Mediterráneo. Lo primero es cargar los tres rasters, para lo que necesitaremos la librería <code>terra</code> y su función <code>rast()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.7.78</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Adjuntando el paquete: 'terra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>elevation <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"./data/meteo/meteo_espacial/rasters_meteo/elevation.txt"</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>d_atl <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"./data/meteo/meteo_espacial/rasters_meteo/d_atl.txt"</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>d_medit <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"./data/meteo/meteo_espacial/rasters_meteo/d_medit.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos visualizarlos de manera sencilla con <code>plot()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elevation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d_atl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-38-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d_medit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-38-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ahora vamos a guardar esos 3 rasters en un único objeto, como si fuera un raster multibanda. Este objeto se conoce como <code>stack</code>. Para crearlo usaremos la función <code>c()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>rasters <span class="ot">&lt;-</span> <span class="fu">c</span>(elevation, d_atl, d_medit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como los componentes del <code>stack</code> tienen los mismos nombres que usamos para ajustar el modelo, podemos realizar predicciones usando los valores continuos de los rasters. Cuando tecleemos <code>predict()</code> R reconocerá que el input son rasters, y usará la función <code>predict()</code> del paquete <code>terra</code>. La función <code>predict()</code>del paquete <code>terra</code>se diferencia en el número y orden de los argumentos. Primero hay que proporcionarle el <code>SpatRaster</code> que contiene las variables, y después el modelo ajustado - al revés de lo que hacíamos antes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>pred_continua <span class="ot">&lt;-</span> <span class="fu">predict</span>(rasters, mod_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora ya podemos representar las predicciones, que en este caso, como el input era un raster, será también un raster:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_continua)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Por supuesto, el procedimiento funcionaría exactamente igual con un modelo de regresión múltiple:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>pred_cont_multiple <span class="ot">&lt;-</span> <span class="fu">predict</span>(rasters, mod_mult2)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_cont_multiple)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="01_RegresionLineal_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./00_RMarkdown_Quarto.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introducción a Quarto y RMarkdown</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02_GLM.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Regresión lineal generalizada (GLM) en R</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Apuntes y ejercicios de geoestadística forestal. Aitor Ameztegui, Universitat de Lleida.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Este libro se ha elaborado con <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>